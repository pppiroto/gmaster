@model IEnumerable<Gmaster.Models.Columns>
@{
    ViewData["Title"] = "Records";
}
<script type="text/javascript" charset="utf-8">
    webix.ready(function () {
        if (webix.CustomScroll && !webix.env.touch) webix.CustomScroll.init();

        var form_layout = {
            margin: 10, padding: 0, type: "wide",
            view: "flexlayout",
            cols: [{
                rows: [
                    {
                        height: 35,
                        view: "toolbar",
                        elements: [
                            { view: "label", label: "@(ViewBag.Remarks ?? ViewBag.Table)" }
                        ]
                    },
                    {
                        view: "form",
                        id: "columns_form",
                        width: 300,
                        elements: [
                            @foreach (var colmn in Model) {
                                <text>
                            { view: "text", value: '', label: "@(colmn.remarks ?? colmn.colname)", name: "@(colmn.colname)"},
                                </text>
                            }
                        ]
                    }
                ]
            }]
        };

        var content_layout = {
            margin: 10, padding: 0, type: "wide",
            view: "flexlayout",
            cols: [{
                rows: [
                    {
                        view: "pager",
                        id: "records_pager",
                        template:" {common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()}",
                        size: 50,
                        group: 5,
                    },
                    {
                        view: "datatable",
                        id: "record_table",
                        @Html.Raw((ViewBag.KeyCount > 0)? $"leftSplit:{ViewBag.KeyCount},":"")
                        columns: [
                            @foreach (var colmn in Model) {
                                <text>
                                { id: "@(colmn.colname)", header: "@(colmn.remarks ?? colmn.colname)", adjust: true @Html.Raw((colmn.keyseq > 0) ? ", css:\"keycol\"" : "")},
                                </text>
                            }
                        ],
                        position: "flex",
                        select: true,
                        pager: "records_pager",
                    }
                ]
            }]
        };

        webix.ui({
            id: "root_layout",
            rows: [
                {
                    view: "toolbar", id: "mybar", elements: [
                        { view: "button", value: "Search", width: 70, click: "btnSearch_click" },
                        { view: "button", value: "Clear", width: 70, click: "$$('columns_form').clear()" },
                    ]
                },
                { 
                    cols: [
                        { view: "scrollview", width:300, body: form_layout },
                        { view: "resizer" },
                        { view: "scrollview", body: content_layout },
                    ]
                },
                { template: "status: hoge", height: 30 }
            ]
        });
        webix.ui.fullScreen();
    });

    function btnSearch_click() {
        var forms = $$("columns_form").getValues();
        var url = "/api/Tables/@(ViewBag.Schema)/@(ViewBag.Table)";

        webix.ajax().post(url, forms, function(text, data, XmlHttpRequest){
            var table = $$("record_table");
            table.clearAll();
            table.parse(data.json().records);
        });
    }
</script>